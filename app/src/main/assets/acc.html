<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>滑动列表展示</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            overflow-x: hidden;
        }

        /* 屏幕阅读器专用的隐藏类 - 让辅助服务可以读取 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* ==================== 列表页样式 ==================== */
        #listPage {
            display: block;
        }

        #listPage.hidden {
            display: none;
        }

        /* 固定按钮 */
        .toggle-btn {
            position: fixed;
            top: 40px;
            right: 40px;
            z-index: 1000;
            padding: 20px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .toggle-btn:active {
            transform: scale(0.95);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* 列表容器 */
        .list-container {
            padding: 30px;
            padding-top: 40px;
        }

        /* 横向滚动区域 */
        .horizontal-section {
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .horizontal-scroll {
            display: flex;
            overflow-x: auto;
            gap: 30px;
            padding: 20px 0;
            scrollbar-width: thin;
        }

        .horizontal-scroll::-webkit-scrollbar {
            height: 12px;
        }

        .horizontal-scroll::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 6px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 6px;
        }

        .horizontal-item {
            flex: 0 0 auto;
            width: 600px;
            height: 400px;
            position: relative;
            border-radius: 20px;
            overflow: visible;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .horizontal-item:active {
            transform: scale(0.98);
            box-shadow: 0 12px 30px rgba(0,0,0,0.25);
        }

        .horizontal-item-inner {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        /* 垂直网格 */
        .vertical-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 35px;
            padding: 20px 0;
        }

        .vertical-item {
            background: white;
            border-radius: 20px;
            overflow: visible;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .vertical-item:active {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        }

        .item-image-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
            cursor: pointer;
            border-radius: 20px 20px 0 0;
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .badge {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 10;
        }

        .badge.hidden {
            display: none;
        }

        .item-title {
            padding: 25px;
            font-size: 26px;
            color: #333;
            font-weight: 500;
            line-height: 1.4;
            position: relative;
        }

        .section-title {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 6px solid #667eea;
        }

        .clickable-container {
            position: relative;
        }

        .clickable-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            border-radius: 20px;
        }

        .clickable-container:active::after {
            opacity: 1;
        }

        /* ==================== 详情页样式 ==================== */
        #detailPage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #detailPage.show {
            display: flex;
            flex-direction: column;
            opacity: 1;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .back-btn {
            padding: 15px 40px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .back-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .detail-badge {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            transition: opacity 0.3s, transform 0.3s;
            position: relative;
        }

        .detail-badge.hidden {
            display: none;
        }

        .detail-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .detail-image-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .detail-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            cursor: zoom-in;
            transition: transform 0.3s ease;
        }

        .detail-image.zoomed {
            cursor: zoom-out;
            transform: scale(1.5);
        }

        .detail-footer {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 40px;
            position: relative;
        }

        .detail-title {
            color: white;
            font-size: 32px;
            font-weight: 500;
            line-height: 1.5;
            text-align: center;
        }

        .detail-info {
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            margin-top: 15px;
            text-align: center;
        }

        .zoom-hint {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 22px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            animation: fadeInOut 3s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        /* 横屏适配 */
        @media screen and (orientation: landscape) {
            .horizontal-scroll {
                flex-wrap: nowrap;
            }
            .horizontal-item {
                min-width: 25%;
            }
        }
    </style>
</head>
<body>
<!-- ==================== 列表页 ==================== -->
<div id="listPage">
    <!-- 固定按钮 -->
    <button class="toggle-btn"
            onclick="toggleBadges()"
            role="button"
            aria-label="切换角标">
        <span id="btnText">隐藏角标</span>
        <span id="toggleBtn_desc" class="sr-only"></span>
    </button>

    <div class="list-container">
        <!-- 横向滚动区域 -->
        <h2 class="section-title" role="heading" aria-level="2">热门推荐</h2>
        <div class="horizontal-section" role="region">
            <div class="horizontal-scroll" id="horizontalScroll" role="list">
                <!-- 动态生成 -->
            </div>
        </div>

        <!-- 垂直网格区域 -->
        <h2 class="section-title" role="heading" aria-level="2">精选内容</h2>
        <div class="vertical-section" id="verticalSection" role="list">
            <!-- 动态生成 -->
        </div>
    </div>
</div>

<!-- ==================== 详情页 ==================== -->
<div id="detailPage" role="dialog" aria-modal="true">
    <div class="detail-header">
        <button class="back-btn"
                onclick="closeDetail()"
                role="button"
                aria-label="返回">
            ← 返回
            <span id="backBtn_desc" class="sr-only"></span>
        </button>
        <div class="detail-badge" id="detailBadge">1</div>
        <span id="detailBadge_desc" class="sr-only"></span>
    </div>

    <div class="detail-content">
        <div class="detail-image-container">
            <img class="detail-image"
                 id="detailImage"
                 src=""
                 alt=""
                 onclick="toggleZoom()"
                 role="img">
            <span id="detailImage_desc" class="sr-only"></span>
        </div>
        <div class="zoom-hint">双击可放大查看</div>
    </div>

    <div class="detail-footer">
        <h3 class="detail-title" id="detailTitle">图片标题</h3>
        <span id="detailTitle_desc" class="sr-only"></span>
        <p class="detail-info" id="detailInfo">图片信息</p>
    </div>
</div>

<script>
    let showBadges = true;
    let currentDetailData = null;
    let isZoomed = false;

    // 数据源
    const horizontalData = [
        { id: 1, image: 'https://picsum.photos/600/400?random=1', title: '热门推荐图片1' },
        { id: 2, image: 'https://picsum.photos/600/400?random=2', title: '热门推荐图片2' },
        { id: 3, image: 'https://picsum.photos/600/400?random=3', title: '热门推荐图片3' },
        { id: 4, image: 'https://picsum.photos/600/400?random=4', title: '热门推荐图片4' }
    ];

    const verticalData = [];
    for (let i = 5; i <= 20; i++) {
        verticalData.push({
            id: i,
            image: `https://picsum.photos/400/300?random=${i}`,
            title: `精彩内容标题 ${i} - 这是一段描述文字`
        });
    }

    /**
     * 从Android获取JSON描述
     * @param {string} actionName - 动作名称
     * @param {string} contentDescription - 内容描述
     * @param {string} viewId - 视图ID
     * @returns {string} JSON字符串
     */
    function getDescriptionFromAndroid(actionName, contentDescription, viewId) {
        try {
            if (typeof window.AndroidBridge !== 'undefined' &&
                typeof window.AndroidBridge.getBadgeDescription === 'function') {

                const jsonResult = window.AndroidBridge.getBadgeDescription(
                    actionName,
                    contentDescription,
                    viewId
                );

                console.log(`获取描述 [${viewId}]:`, jsonResult);
                return jsonResult;
            } else {
                console.warn('AndroidBridge.getBadgeDescription 未找到');
                // 返回默认JSON格式
                return JSON.stringify({
                    "operate_type": "click",
                    "action_name": actionName,
                    "contentDescription": contentDescription,
                    "view_id": viewId
                });
            }
        } catch (error) {
            console.error('获取描述失败:', error);
            return JSON.stringify({
                "operate_type": "click",
                "action_name": actionName,
                "contentDescription": contentDescription,
                "view_id": viewId
            });
        }
    }

    /**
     * 打开详情页
     */
    function openDetail(itemId, imageUrl, title) {
        console.log(`打开详情: ID=${itemId}, URL=${imageUrl}, Title=${title}`);

        currentDetailData = { id: itemId, image: imageUrl, title: title };

        // 更新详情页基本内容
        const detailImage = document.getElementById('detailImage');
        const detailTitle = document.getElementById('detailTitle');
        const detailInfo = document.getElementById('detailInfo');
        const detailBadge = document.getElementById('detailBadge');

        detailImage.src = imageUrl;
        detailTitle.textContent = title;
        detailInfo.textContent = `图片ID: ${itemId}`;
        detailBadge.textContent = itemId;

        // 获取并设置详情页各元素的独立JSON描述

        // 1. 返回按钮
        const backBtnDesc = getDescriptionFromAndroid(
            'back_to_list',
            '返回列表',
            'detail_back_btn'
        );
        document.getElementById('backBtn_desc').textContent = backBtnDesc;

        // 2. 角标
        const badgeDesc = getDescriptionFromAndroid(
            `detail_badge_${itemId}`,
            `序号${itemId}`,
            `detail_badge_${itemId}`
        );
        document.getElementById('detailBadge_desc').textContent = badgeDesc;

        // 3. 图片
        const imageDesc = getDescriptionFromAndroid(
            `view_detail_image_${itemId}`,
            `${title}的放大图片`,
            `detail_image_${itemId}`
        );
        document.getElementById('detailImage_desc').textContent = imageDesc;

        // 4. 标题
        const titleDesc = getDescriptionFromAndroid(
            `detail_title_${itemId}`,
            title,
            `detail_title_${itemId}`
        );
        document.getElementById('detailTitle_desc').textContent = titleDesc;

        // 角标显示/隐藏状态同步
        if (!showBadges) {
            detailBadge.classList.add('hidden');
        } else {
            detailBadge.classList.remove('hidden');
        }

        // 显示详情页
        const detailPage = document.getElementById('detailPage');
        detailPage.classList.add('show');
        document.getElementById('listPage').classList.add('hidden');

        window.scrollTo(0, 0);

        // 通知Android
        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onImageDetailOpened === 'function') {
            window.AndroidBridge.onImageDetailOpened(itemId, imageUrl, title);
        }
    }

    /**
     * 关闭详情页
     */
    function closeDetail() {
        console.log('关闭详情页');

        const detailPage = document.getElementById('detailPage');
        detailPage.classList.remove('show');
        document.getElementById('listPage').classList.remove('hidden');

        isZoomed = false;
        const detailImage = document.getElementById('detailImage');
        detailImage.classList.remove('zoomed');

        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onImageDetailClosed === 'function') {
            window.AndroidBridge.onImageDetailClosed(currentDetailData?.id || 0);
        }

        currentDetailData = null;
    }

    /**
     * 图片缩放切换
     */
    function toggleZoom() {
        const detailImage = document.getElementById('detailImage');
        isZoomed = !isZoomed;

        if (isZoomed) {
            detailImage.classList.add('zoomed');
        } else {
            detailImage.classList.remove('zoomed');
        }
    }

    /**
     * 渲染横向列表
     */
    function renderHorizontalList() {
        const container = document.getElementById('horizontalScroll');

        horizontalData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'horizontal-item clickable-container';
            div.setAttribute('role', 'listitem');
            div.setAttribute('data-item-id', item.id);

            // 创建内部结构
            const inner = document.createElement('div');
            inner.className = 'horizontal-item-inner';

            // 角标
            const badge = document.createElement('div');
            badge.className = 'badge';
            badge.id = `badge_${item.id}`;
            badge.textContent = item.id;

            // 角标的JSON描述
            const badgeDesc = document.createElement('span');
            badgeDesc.className = 'sr-only';
            badgeDesc.id = `badge_${item.id}_desc`;
            const badgeJson = getDescriptionFromAndroid(
                `play_index`,
                `${item.id}`,
                `badge_${item.id}`
            );
            badgeDesc.textContent = badgeJson;
            badge.appendChild(badgeDesc);

            // 图片
            const img = document.createElement('img');
            img.className = 'item-image';
            img.src = item.image;
            img.alt = '';
            img.id = `image_${item.id}`;

            // 图片的JSON描述
            const imgDesc = document.createElement('span');
            imgDesc.className = 'sr-only';
            imgDesc.id = `image_${item.id}_desc`;
            const imgJson = getDescriptionFromAndroid(
                `image_${item.id}`,
                item.title,
                `image_${item.id}`
            );
            imgDesc.textContent = imgJson;

            inner.appendChild(badge);
            inner.appendChild(img);
            inner.appendChild(imgDesc);

            // 容器的JSON描述
            const containerDesc = document.createElement('span');
            containerDesc.className = 'sr-only';
            containerDesc.id = `container_${item.id}_desc`;
            const containerJson = getDescriptionFromAndroid(
                `view_image_${item.id}`,
                `查看${item.title}`,
                `container_${item.id}`
            );
            containerDesc.textContent = containerJson;

            div.appendChild(inner);
            div.appendChild(containerDesc);

            // 点击事件
            div.addEventListener('click', function() {
                openDetail(item.id, item.image, item.title);
            });

            container.appendChild(div);
        });
    }

    /**
     * 渲染垂直列表
     */
    function renderVerticalList() {
        const container = document.getElementById('verticalSection');

        verticalData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'vertical-item';
            div.setAttribute('role', 'listitem');

            // 图片包裹容器
            const wrapper = document.createElement('div');
            wrapper.className = 'item-image-wrapper clickable-container';
            wrapper.id = `wrapper_${item.id}`;
            wrapper.setAttribute('data-item-id', item.id);

            // 角标
            const badge = document.createElement('div');
            badge.className = 'badge';
            badge.id = `badge_${item.id}`;
            badge.textContent = item.id;

            // 角标的JSON描述
            const badgeDesc = document.createElement('span');
            badgeDesc.className = 'sr-only';
            badgeDesc.id = `badge_${item.id}_desc`;
            const badgeJson = getDescriptionFromAndroid(
                `play_index`,
                `${item.id}`,
                `badge_${item.id}`
            );
            badgeDesc.textContent = badgeJson;
            badge.appendChild(badgeDesc);

            // 图片
            const img = document.createElement('img');
            img.className = 'item-image';
            img.src = item.image;
            img.alt = '';
            img.id = `image_${item.id}`;

            // 图片的JSON描述
            const imgDesc = document.createElement('span');
            imgDesc.className = 'sr-only';
            imgDesc.id = `image_${item.id}_desc`;
            const imgJson = getDescriptionFromAndroid(
                `image_${item.id}`,
                item.title,
                `image_${item.id}`
            );
            imgDesc.textContent = imgJson;

            // 容器的JSON描述
            const wrapperDesc = document.createElement('span');
            wrapperDesc.className = 'sr-only';
            wrapperDesc.id = `wrapper_${item.id}_desc`;
            const wrapperJson = getDescriptionFromAndroid(
                `view_image_${item.id}`,
                `查看${item.title}`,
                `wrapper_${item.id}`
            );
            wrapperDesc.textContent = wrapperJson;

            wrapper.appendChild(badge);
            wrapper.appendChild(img);
            wrapper.appendChild(imgDesc);
            wrapper.appendChild(wrapperDesc);

            // 标题
            const titleDiv = document.createElement('div');
            titleDiv.className = 'item-title';
            titleDiv.id = `title_${item.id}`;
            titleDiv.textContent = item.title;

            // 标题的JSON描述
            const titleDesc = document.createElement('span');
            titleDesc.className = 'sr-only';
            titleDesc.id = `title_${item.id}_desc`;
            const titleJson = getDescriptionFromAndroid(
                `title_${item.id}`,
                item.title,
                `title_${item.id}`
            );
            titleDesc.textContent = titleJson;
            titleDiv.appendChild(titleDesc);

            // 点击事件
            wrapper.addEventListener('click', function() {
                openDetail(item.id, item.image, item.title);
            });

            div.appendChild(wrapper);
            div.appendChild(titleDiv);
            container.appendChild(div);
        });
    }

    /**
     * 切换角标显示/隐藏
     */
    function toggleBadges() {
        showBadges = !showBadges;
        const badges = document.querySelectorAll('.badge, .detail-badge');
        const btnText = document.getElementById('btnText');

        badges.forEach(badge => {
            if (showBadges) {
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        });

        btnText.textContent = showBadges ? '隐藏角标' : '显示角标';

        // 通知Android
        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onBadgeToggle === 'function') {
            window.AndroidBridge.onBadgeToggle(showBadges);
        }
    }

    /**
     * 初始化按钮描述
     */
    function initToggleButtonDescription() {
        const toggleBtnJson = getDescriptionFromAndroid(
            'toggle_badge_visibility',
            '切换角标显示隐藏',
            'toggle_badge_btn'
        );
        document.getElementById('toggleBtn_desc').textContent = toggleBtnJson;
    }

    /**
     * 页面加载完成
     */
    window.addEventListener('DOMContentLoaded', function() {
        console.log('页面开始加载...');

        // 初始化按钮
        initToggleButtonDescription();

        // 渲染列表
        renderHorizontalList();
        renderVerticalList();

        // 通知Android
        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onPageLoaded === 'function') {
            window.AndroidBridge.onPageLoaded();
        }

        console.log('页面加载完成，所有元素已设置独立的JSON描述');
    });

    /**
     * 监听返回键
     */
    window.addEventListener('popstate', function(e) {
        const detailPage = document.getElementById('detailPage');
        if (detailPage.classList.contains('show')) {
            e.preventDefault();
            closeDetail();
        }
    });

    /**
     * 暴露给Android的方法
     */
    window.closeDetailPage = function() {
        closeDetail();
    };

    window.getCurrentPage = function() {
        const detailPage = document.getElementById('detailPage');
        return detailPage.classList.contains('show') ? 'detail' : 'list';
    };

    // 动态更新某个元素的描述
    window.updateElementDescription = function(elementId, actionName, contentDescription, viewId) {
        const descElement = document.getElementById(`${elementId}_desc`);
        if (descElement) {
            const newJson = getDescriptionFromAndroid(actionName, contentDescription, viewId);
            descElement.textContent = newJson;
            console.log(`已更新元素${elementId}的描述:`, newJson);
            return true;
        }
        return false;
    };
</script>
</body>
</html>