<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>æ»‘åŠ¨åˆ—è¡¨å±•ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            overflow-x: hidden;
        }

        /* å±å¹•é˜…è¯»å™¨ä¸“ç”¨éšè—ç±» */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* ==================== åˆ—è¡¨é¡µæ ·å¼ ==================== */
        #listPage {
            display: block;
        }

        #listPage.hidden {
            display: none;
        }

        /* å›ºå®šæŒ‰é’® */
        .toggle-btn {
            position: fixed;
            top: 40px;
            right: 40px;
            z-index: 1000;
            padding: 20px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }

        .toggle-btn:active {
            transform: scale(0.95);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* åˆ—è¡¨å®¹å™¨ */
        .list-container {
            padding: 30px;
            padding-top: 40px;
        }

        /* æ¨ªå‘æ»šåŠ¨åŒºåŸŸ */
        .horizontal-section {
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .horizontal-scroll {
            display: flex;
            overflow-x: auto;
            gap: 30px;
            padding: 20px 0;
            scrollbar-width: thin;
        }

        .horizontal-scroll::-webkit-scrollbar {
            height: 12px;
        }

        .horizontal-scroll::-webkit-scrollbar-track {
            background: #e0e0e0;
            border-radius: 6px;
        }

        .horizontal-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 6px;
        }

        .horizontal-item {
            flex: 0 0 auto;
            width: 600px;
            height: 400px;
            position: relative;
            border-radius: 20px;
            overflow: visible;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .horizontal-item:active {
            transform: scale(0.98);
            box-shadow: 0 12px 30px rgba(0,0,0,0.25);
        }

        .horizontal-item-inner {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        /* å‚ç›´ç½‘æ ¼ */
        .vertical-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 35px;
            padding: 20px 0;
        }

        .vertical-item {
            background: white;
            border-radius: 20px;
            overflow: visible;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .vertical-item:active {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.2);
        }

        .item-image-wrapper {
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
            cursor: pointer;
            border-radius: 20px 20px 0 0;
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            position: relative;
        }

        .badge {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: opacity 0.3s, transform 0.3s;
            z-index: 10;
        }

        .badge.hidden {
            display: none;
        }

        .item-title {
            padding: 25px;
            font-size: 26px;
            color: #333;
            font-weight: 500;
            line-height: 1.4;
            position: relative;
        }

        .section-title {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-left: 10px;
            border-left: 6px solid #667eea;
        }

        .clickable-container {
            position: relative;
        }

        .clickable-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            border-radius: 20px;
        }

        .clickable-container:active::after {
            opacity: 1;
        }

        /* ==================== è¯¦æƒ…é¡µæ ·å¼ ==================== */
        #detailPage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #detailPage.show {
            display: flex;
            flex-direction: column;
            opacity: 1;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .back-btn {
            padding: 15px 40px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            border-radius: 50px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .back-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .detail-badge {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            transition: opacity 0.3s, transform 0.3s;
            position: relative;
        }

        .detail-badge.hidden {
            display: none;
        }

        .detail-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .detail-image-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .detail-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            cursor: zoom-in;
            transition: transform 0.3s ease;
            position: relative;
        }

        .detail-image.zoomed {
            cursor: zoom-out;
            transform: scale(1.5);
        }

        .detail-footer {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 40px;
            position: relative;
        }

        .detail-title {
            color: white;
            font-size: 32px;
            font-weight: 500;
            line-height: 1.5;
            text-align: center;
            position: relative;
        }

        .detail-info {
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            margin-top: 15px;
            text-align: center;
        }

        .zoom-hint {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 22px;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            animation: fadeInOut 3s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
<!-- ==================== åˆ—è¡¨é¡µ ==================== -->
<div id="listPage">
    <!-- å›ºå®šæŒ‰é’® -->
    <button class="toggle-btn" onclick="toggleBadges()" id="toggleBtn"> <span id="btnText">éšè—è§’æ ‡</span>
        <!-- æŒ‰é’®çš„JSONæè¿° --> <span id="toggleBtn_desc" class="sr-only"></span> </button>
    <div class="list-container">
        <!-- æ¨ªå‘æ»šåŠ¨åŒºåŸŸ -->
        <h2 class="section-title">çƒ­é—¨æ¨è</h2>
        <div class="horizontal-section">
            <div class="horizontal-scroll" id="horizontalScroll">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        <!-- å‚ç›´ç½‘æ ¼åŒºåŸŸ -->
        <h2 class="section-title">ç²¾é€‰å†…å®¹</h2>
        <div class="vertical-section" id="verticalSection">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>
<!-- ==================== è¯¦æƒ…é¡µ ==================== -->
<div id="detailPage">
    <div class="detail-header">
        <button class="back-btn" onclick="closeDetail()" id="backBtn">
            <span aria-hidden="true">â† è¿”å›</span>
            <span id="backBtn_desc" class="sr-only"></span>
        </button>
        <div class="detail-badge" id="detailBadge">
            <span aria-hidden="true">1</span>
            <span id="detailBadge_desc" class="sr-only"></span>
        </div>
    </div>
    <div class="detail-content">
        <div class="detail-image-container">
            <img class="detail-image" id="detailImage" src="" alt="" onclick="toggleZoom()" />
            <!-- è¯¦æƒ…é¡µå›¾ç‰‡çš„JSONæè¿° -->
            <span id="detailImage_desc" class="sr-only"></span>
        </div>
        <div class="zoom-hint">
            ç‚¹å‡»å¯æ”¾å¤§æŸ¥çœ‹
        </div>
    </div>
    <div class="detail-footer">
        <h3 class="detail-title" id="detailTitle">å›¾ç‰‡æ ‡é¢˜
            <!-- è¯¦æƒ…é¡µæ ‡é¢˜çš„JSONæè¿° --> <span id="detailTitle_desc" class="sr-only"></span> </h3>
        <p class="detail-info" id="detailInfo">å›¾ç‰‡ä¿¡æ¯</p>
    </div>
</div>
<script>
    let showBadges = true;
    let currentDetailData = null;
    let isZoomed = false;

    // æ•°æ®æº
    const horizontalData = [
        { id: 1, image: 'https://picsum.photos/600/400?random=1', title: 'é™¨çŸ³å‘' },
        { id: 2, image: 'https://picsum.photos/600/400?random=2', title: 'æ‰‹æœº' },
        { id: 3, image: 'https://picsum.photos/600/400?random=3', title: 'ç›¸æœº' },
        { id: 4, image: 'https://picsum.photos/600/400?random=4', title: 'å¤§æ¡¥' }
    ];

    const verticalData = [];
    for (let i = 5; i <= 20; i++) {
        verticalData.push({
            id: i,
            image: `https://picsum.photos/400/300?random=${i}`,
            title: `é£æ™¯${i}`
        });
    }

    /**
     * ä»Androidè·å–JSONæè¿°
     */
    function getDescriptionFromAndroid(actionName, contentDescription, viewId) {
        try {
            if (typeof window.AndroidBridge !== 'undefined' &&
                typeof window.AndroidBridge.getBadgeDescription === 'function') {

                const jsonResult = window.AndroidBridge.getBadgeDescription(
                    actionName,
                    contentDescription,
                    viewId
                );

                console.log(`[${viewId}] JSON:`, jsonResult);
                return jsonResult;
            } else {
                // é»˜è®¤è¿”å›
                return JSON.stringify({
                    "operate_type": "click",
                    "action_name": actionName,
                    "contentDescription": contentDescription,
                    "view_id": viewId
                });
            }
        } catch (error) {
            console.error('è·å–æè¿°å¤±è´¥:', error);
            return JSON.stringify({
                "operate_type": "click",
                "action_name": actionName,
                "contentDescription": contentDescription,
                "view_id": viewId
            });
        }
    }

    /**
     * æ‰“å¼€è¯¦æƒ…é¡µ
     */
    function openDetail(itemId, imageUrl, title) {
        console.log(`æ‰“å¼€è¯¦æƒ…: ID=${itemId}`);

        currentDetailData = { id: itemId, image: imageUrl, title: title };

        // æ›´æ–°è¯¦æƒ…é¡µå†…å®¹
        const detailImage = document.getElementById('detailImage');
        const detailTitle = document.getElementById('detailTitle');
        const detailInfo = document.getElementById('detailInfo');
        const detailBadge = document.getElementById('detailBadge');

        detailImage.src = imageUrl;
        detailTitle.childNodes[0].textContent = title; // åªæ›´æ–°æ–‡æœ¬èŠ‚ç‚¹
        detailInfo.textContent = `å›¾ç‰‡ID: ${itemId}`;
        detailBadge.childNodes[0].textContent = itemId; // åªæ›´æ–°æ–‡æœ¬èŠ‚ç‚¹

        // æ›´æ–°è¯¦æƒ…é¡µå„å…ƒç´ çš„JSONæè¿°

        // 1. è¿”å›æŒ‰é’®
        document.getElementById('backBtn_desc').textContent = getDescriptionFromAndroid(
            'action_click',
            'è¿”å›',
            'detail_back_btn'
        );

        // 2. è§’æ ‡
        document.getElementById('detailBadge_desc').textContent = getDescriptionFromAndroid(
            `play_index`,
            `${itemId}`,
            `detail_badge_${itemId}`
        );

        // 3. å›¾ç‰‡
        detailImage.alt = ''; // æ¸…ç©ºalt
        document.getElementById('detailImage_desc').textContent = getDescriptionFromAndroid(
            `action_general_label`,
            'å›¾ç‰‡ğŸ–¼',
            `detail_image_${itemId}`
        );

        // 4. æ ‡é¢˜
        document.getElementById('detailTitle_desc').textContent = getDescriptionFromAndroid(
            `action_click`,
            title,
            `detail_title_${itemId}`
        );

        // è§’æ ‡æ˜¾ç¤º/éšè—çŠ¶æ€åŒæ­¥
        if (!showBadges) {
            detailBadge.classList.add('hidden');
        } else {
            detailBadge.classList.remove('hidden');
        }

        // æ˜¾ç¤ºè¯¦æƒ…é¡µ
        document.getElementById('detailPage').classList.add('show');
        document.getElementById('listPage').classList.add('hidden');
        window.scrollTo(0, 0);

        // é€šçŸ¥Android
        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onImageDetailOpened === 'function') {
            window.AndroidBridge.onImageDetailOpened(itemId, imageUrl, title);
        }
    }

    /**
     * å…³é—­è¯¦æƒ…é¡µ
     */
    function closeDetail() {
        document.getElementById('detailPage').classList.remove('show');
        document.getElementById('listPage').classList.remove('hidden');

        isZoomed = false;
        document.getElementById('detailImage').classList.remove('zoomed');

        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onImageDetailClosed === 'function') {
            window.AndroidBridge.onImageDetailClosed(currentDetailData?.id || 0);
        }

        currentDetailData = null;
    }

    /**
     * å›¾ç‰‡ç¼©æ”¾
     */
    function toggleZoom() {
        const detailImage = document.getElementById('detailImage');
        isZoomed = !isZoomed;

        if (isZoomed) {
            detailImage.classList.add('zoomed');
        } else {
            detailImage.classList.remove('zoomed');
        }
    }

    /**
     * æ¸²æŸ“æ¨ªå‘åˆ—è¡¨
     */
    function renderHorizontalList() {
        const container = document.getElementById('horizontalScroll');

        horizontalData.forEach(item => {
            // å¤–å±‚å®¹å™¨ - åªè´Ÿè´£å¸ƒå±€å’Œç‚¹å‡»
            const outerDiv = document.createElement('div');
            outerDiv.className = 'horizontal-item clickable-container';

            // å†…å±‚å®¹å™¨
            const innerDiv = document.createElement('div');
            innerDiv.className = 'horizontal-item-inner';

            // 1. è§’æ ‡å…ƒç´ ï¼ˆç‹¬ç«‹ï¼‰
            const badge = document.createElement('div');
            badge.className = 'badge';
            badge.alt = '';
            badge.id = `badge_${item.id}`;
            badge.textContent = item.id;
            badge.setAttribute('aria-hidden', 'true'); // âœ… å¿½ç•¥è§’æ ‡æœ¬èº«

            // è§’æ ‡çš„JSONæè¿° - æ³¨æ„ï¼šä¸è¦appendChildåˆ°badgeé‡Œï¼
            const badgeDesc = document.createElement('span');
            badgeDesc.className = 'sr-only';
            badgeDesc.id = `badge_${item.id}_desc`;
            badgeDesc.textContent = getDescriptionFromAndroid(
                `play_index`,
                `${item.id}`,
                `badge_${item.id}`
            );

            // 2. å›¾ç‰‡å…ƒç´ ï¼ˆç‹¬ç«‹ï¼‰
            const img = document.createElement('img');
            img.className = 'item-image';
            img.src = item.image;
            img.alt = '';
            img.id = `image_${item.id}`;
            img.setAttribute('aria-hidden', 'true'); // âœ… å¿½ç•¥å›¾ç‰‡æœ¬èº«


            // å›¾ç‰‡çš„JSONæè¿°
            const imgDesc = document.createElement('span');
            imgDesc.className = 'sr-only';
            imgDesc.id = `image_${item.id}_desc`;
            imgDesc.textContent = getDescriptionFromAndroid(
                `action_general_label`,
                item.title,
                `image_${item.id}`
            );

            // âœ… æ­£ç¡®çš„é¡ºåºï¼šå…ˆæ·»åŠ å¯è§å…ƒç´ ï¼Œå†æ·»åŠ æè¿°å…ƒç´ 
            innerDiv.appendChild(badge);
            innerDiv.appendChild(badgeDesc); // âœ… badgeDescä½œä¸ºå…„å¼Ÿå…ƒç´ 
            innerDiv.appendChild(img);
            innerDiv.appendChild(imgDesc); // âœ… imgDescä½œä¸ºå…„å¼Ÿå…ƒç´ 
            outerDiv.appendChild(innerDiv);
            // ç‚¹å‡»äº‹ä»¶
            outerDiv.addEventListener('click', function() {
                openDetail(item.id, item.image, item.title);
            });

            container.appendChild(outerDiv);
        });
    }

    /**
     * æ¸²æŸ“å‚ç›´åˆ—è¡¨
     */
    function renderVerticalList() {
        const container = document.getElementById('verticalSection');

        verticalData.forEach(item => {
            // å¤–å±‚å®¹å™¨
            const itemDiv = document.createElement('div');
            itemDiv.className = 'vertical-item';

            // å›¾ç‰‡åŒ…è£¹å®¹å™¨
            const wrapper = document.createElement('div');
            wrapper.className = 'item-image-wrapper clickable-container';
            wrapper.id = `wrapper_${item.id}`;

            // 1. è§’æ ‡å…ƒç´ ï¼ˆç‹¬ç«‹ï¼‰
            const badge = document.createElement('div');
            badge.className = 'badge';
            badge.id = `play_index`;
            badge.textContent = item.id;
            badge.setAttribute('aria-hidden', 'true');
            // è§’æ ‡çš„JSONæè¿°
            const badgeDesc = document.createElement('span');
            badgeDesc.className = 'sr-only';
            badgeDesc.id = `badge_${item.id}_desc`;
            badgeDesc.textContent = getDescriptionFromAndroid(
                `play_index`,
                `${item.id}`,
                `badge_${item.id}`
            );


            // 2. å›¾ç‰‡å…ƒç´ ï¼ˆç‹¬ç«‹ï¼‰
            const img = document.createElement('img');
            img.className = 'item-image';
            img.src = item.image;
            img.alt = ''; // ç®€å•æ–‡æœ¬
            img.id = `image_${item.id}`;
            img.setAttribute('aria-hidden', 'true');
            // å›¾ç‰‡çš„JSONæè¿°
            const imgDesc = document.createElement('span');
            imgDesc.className = 'sr-only';
            imgDesc.id = `image_${item.id}_desc`;
            imgDesc.textContent = getDescriptionFromAndroid(
                `action_general_label`,
                'å›¾ç‰‡ğŸ’¹', // åªæœ‰æ ‡é¢˜
                `image_${item.id}`
            );


            // 3. æ ‡é¢˜å…ƒç´ ï¼ˆç‹¬ç«‹ï¼‰
            const titleDiv = document.createElement('div');
            titleDiv.className = 'item-title';
            titleDiv.id = `title_${item.id}`;
            titleDiv.textContent = item.title;
            titleDiv.setAttribute('aria-hidden', 'true');
            // æ ‡é¢˜çš„JSONæè¿°
            const titleDesc = document.createElement('span');
            titleDesc.className = 'sr-only';
            titleDesc.id = `title_${item.id}_desc`;
            titleDesc.textContent = getDescriptionFromAndroid(
                `action_general_label`,
                item.title, // åªæœ‰æ ‡é¢˜
                `title_${item.id}`
            );
            wrapper.appendChild(badge);
            wrapper.appendChild(badgeDesc);
            wrapper.appendChild(img);
            wrapper.appendChild(imgDesc);
            wrapper.appendChild(titleDiv);
            wrapper.appendChild(titleDesc);



            itemDiv.appendChild(wrapper);
            itemDiv.appendChild(titleDiv);
            // ç‚¹å‡»äº‹ä»¶
            itemDiv.addEventListener('click', function() {
                openDetail(item.id, item.image, item.title);
            });
            container.appendChild(itemDiv);
        });
    }

    /**
     * åˆ‡æ¢è§’æ ‡
     */
    function toggleBadges() {
        showBadges = !showBadges;
        const badges = document.querySelectorAll('.badge, .detail-badge');
        const btnText = document.getElementById('btnText');

        badges.forEach(badge => {
            if (showBadges) {
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        });

        btnText.textContent = showBadges ? 'éšè—è§’æ ‡' : 'æ˜¾ç¤ºè§’æ ‡';

        // é€šçŸ¥Android
        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onBadgeToggle === 'function') {
            window.AndroidBridge.onBadgeToggle(showBadges);
        }
    }

    /**
     * åˆå§‹åŒ–
     */
    window.addEventListener('DOMContentLoaded', function() {
        console.log('=== é¡µé¢å¼€å§‹åŠ è½½ ===');

        // åˆå§‹åŒ–åˆ‡æ¢æŒ‰é’®çš„JSONæè¿°
        document.getElementById('toggleBtn_desc').textContent = getDescriptionFromAndroid(
            'toggle_badge',
            'åˆ‡æ¢è§’æ ‡æ˜¾ç¤ºéšè—',
            'toggle_badge_btn'
        );

        // æ¸²æŸ“åˆ—è¡¨
        renderHorizontalList();
        renderVerticalList();

        // é€šçŸ¥Android
        if (typeof window.AndroidBridge !== 'undefined' &&
            typeof window.AndroidBridge.onPageLoaded === 'function') {
            window.AndroidBridge.onPageLoaded();
        }

        console.log('=== é¡µé¢åŠ è½½å®Œæˆï¼Œæ‰€æœ‰å…ƒç´ å·²è®¾ç½®ç‹¬ç«‹JSONæè¿° ===');
    });

    /**
     * æš´éœ²ç»™Androidçš„æ–¹æ³•
     */
    window.closeDetailPage = function() {
        closeDetail();
    };

    window.getCurrentPage = function() {
        return document.getElementById('detailPage').classList.contains('show') ? 'detail' : 'list';
    };
</script>
</body>
</html>