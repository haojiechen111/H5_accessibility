# H5平滑滚动接入指南 - 最佳实践

> 让你的H5页面语音滚动也有丝滑动画！3步接入，5分钟搞定。

---

## 快速开始

### 第1步：复制JS文件

将 `smooth-scroll.js` 复制到你的项目中：

```
your-project/
├── assets/
│   └── smooth-scroll.js  ← 复制到这里
├── index.html
└── ...
```

### 第2步：添加class标记

给需要平滑滚动的容器添加 `class="smooth-scroll"`：

```html
<body class="smooth-scroll" style="overflow-y: auto;">
  
  <!-- 横向滚动容器 -->
  <div class="smooth-scroll" style="overflow-x: auto;">
    内容...
  </div>
  
</body>
```

### 第3步：引入JS脚本

在 `</body>` 前引入脚本：

```html
<body class="smooth-scroll">
  <!-- 页面内容 -->
  
  <script src="smooth-scroll.js"></script>
</body>
</html>
```

**完成！** 刷新页面即可生效。

---

## 布局方案选择

### 方案对比

平滑滚动支持两种布局方案，**都是标准且推荐的做法**：

#### 方案1：body直接滚动（推荐用于简单页面）

```html
<body class="smooth-scroll" 
      style="overflow-y: auto;">
  <!-- 页面内容 -->
</body>
```

**适用场景：**
- ✅ 纯内容展示页面
- ✅ 单一滚动方向
- ✅ 不需要固定头部/底部

#### 方案2：div容器滚动（推荐用于复杂应用）⭐

```html
<body>
  <div class="smooth-scroll" 
       style="overflow-y: auto; height: 100vh;">
    <!-- 页面内容 -->
  </div>
</body>
```

**适用场景：**
- ✅ WebView内嵌应用（强烈推荐）
- ✅ 需要固定头部/底部
- ✅ 复杂布局结构
- ✅ 多层滚动区域

> 💡 **提示：** 如果你的应用运行在WebView中，或者有固定定位元素需求，使用div包裹方案会获得更好的兼容性和灵活性。这是业界推荐的最佳实践。

### ⚠️ 重要：避免双层滚动冲突

使用**方案2（div容器滚动）**时，必须确保body不可滚动，否则会导致平滑滚动失效！

#### 错误示例 ❌

```html
<style>
  body {
    padding: 40px 20px;      /* ❌ 有padding */
    min-height: 100vh;       /* ❌ 会导致body可滚动 */
  }
  
  .smooth-scroll {
    height: 100vh;
    overflow-y: auto;
  }
</style>

<!-- 结果：body和div都能滚动 → 平滑动画失效！ -->
```

#### 正确示例 ✅

```html
<style>
  body {
    margin: 0;
    padding: 0;              /* ✅ 无padding */
    height: 100vh;           /* ✅ 固定高度 */
    overflow: hidden;        /* ✅ 禁止滚动 - 关键！*/
  }
  
  .smooth-scroll {
    height: 100vh;
    overflow-y: auto;
    padding: 40px 20px;      /* ✅ padding放在这里 */
  }
</style>
```

**核心原则：一个页面只能有一个主滚动容器！**

---

## 配置规则

### 1. contentDescription匹配规则 ⚠️ 重要

**规则：** `contentDescription` 必须等于 `view_id` 的后缀部分

```html
<!-- ✅ 正确：contentDescription = slide_direction_horizontal -->
<div class="smooth-scroll"
     aria-label='{
       "operate_type":"click",
       "action_name":"slide_direction_horizontal",
       "contentDescription":"slide_direction_horizontal",
       "view_id":"com.xxx:id/slide_direction_horizontal"
     }'
     style="overflow-x: auto;">
  内容...
</div>

<!-- ❌ 错误：contentDescription不匹配 -->
<div class="smooth-scroll"
     aria-label='{
       "contentDescription":"轮播图",
       "view_id":"com.xxx:id/slide_direction_horizontal"
     }'>
```

**为什么这很重要？**
Accessibility服务通过contentDescription来查找和匹配节点。如果不匹配，语音命令无法找到要滚动的容器。

### 2. 常用配置

#### 竖向滚动（整页）
```html
<body class="smooth-scroll"
      aria-label='{
        "operate_type":"click",
        "action_name":"slide_direction_vertical",
        "contentDescription":"slide_direction_vertical",
        "view_id":"com.xxx:id/slide_direction_vertical"
      }'
      style="overflow-y: auto;">
```

#### 横向滚动（容器）
```html
<div class="smooth-scroll"
     aria-label='{
       "operate_type":"click",
       "action_name":"slide_direction_horizontal",
       "contentDescription":"slide_direction_horizontal",
       "view_id":"com.xxx:id/slide_direction_horizontal"
     }'
     style="overflow-x: auto;">
```

### 3. 动画参数调整（可选）

默认参数已经过优化，一般不需要修改。如需调整：

```javascript
// 在引入smooth-scroll.js后
window.SmoothScrollConfig.duration = 500;           // 动画时长：300ms → 500ms
window.SmoothScrollConfig.distanceThreshold = 150;  // 触发距离：100px → 150px
window.SmoothScrollConfig.timeThreshold = 150;      // 时间间隔：100ms → 150ms
```

---

## 完整示例

### 示例1：音乐列表（竖向+横向）

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>音乐列表</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      min-height: 200vh; /* 让页面可以滚动 */
    }
    
    .banner {
      display: flex;
      overflow-x: auto;
      gap: 20px;
      padding: 20px 0;
    }
    
    .banner-item {
      min-width: 300px;
      height: 150px;
      background: #667eea;
      border-radius: 8px;
      flex-shrink: 0;
    }
  </style>
</head>

<!-- 整页竖向滚动 -->
<body class="smooth-scroll"
      aria-label='{
        "operate_type":"click",
        "action_name":"slide_direction_vertical",
        "contentDescription":"slide_direction_vertical",
        "view_id":"com.music.app:id/slide_direction_vertical"
      }'
      style="overflow-y: auto;">
  
  <h1>推荐歌单</h1>
  
  <!-- 横向滚动轮播 -->
  <div class="banner smooth-scroll"
       aria-label='{
         "operate_type":"click",
         "action_name":"slide_direction_horizontal",
         "contentDescription":"slide_direction_horizontal",
         "view_id":"com.music.app:id/slide_direction_horizontal"
       }'>
    <div class="banner-item">歌单1</div>
    <div class="banner-item">歌单2</div>
    <div class="banner-item">歌单3</div>
    <div class="banner-item">歌单4</div>
    <div class="banner-item">歌单5</div>
  </div>
  
  <h2>热门歌曲</h2>
  <!-- 更多内容... -->
  
  <!-- 引入平滑滚动脚本 -->
  <script src="smooth-scroll.js"></script>
</body>
</html>
```

### 示例2：新闻资讯（仅竖向）

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>新闻资讯</title>
</head>

<body class="smooth-scroll"
      aria-label='{
        "operate_type":"click",
        "action_name":"slide_direction_vertical",
        "contentDescription":"slide_direction_vertical",
        "view_id":"com.news.app:id/slide_direction_vertical"
      }'
      style="overflow-y: auto;">
  
  <div class="news-list">
    <div class="news-item">新闻1</div>
    <div class="news-item">新闻2</div>
    <!-- 更多新闻... -->
  </div>
  
  <script src="smooth-scroll.js"></script>
</body>
</html>
```

### 示例3：WebView应用（div容器方案）⭐

```html
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebView应用</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
    }
    
    /* 固定头部 */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 100;
      display: flex;
      align-items: center;
      padding: 0 16px;
    }
    
    /* 主滚动容器 */
    .main-content {
      margin-top: 56px; /* 为固定头部留出空间 */
      overflow-y: auto;
      height: calc(100vh - 56px);
    }
    
    /* 内容区域 */
    .content {
      padding: 16px;
      min-height: 200vh; /* 确保有足够内容可以滚动 */
    }
    
    .card {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body>
  <!-- 固定头部（不滚动） -->
  <header class="app-header">
    <h1 style="font-size: 18px;">我的应用</h1>
  </header>
  
  <!-- 主滚动容器（应用smooth-scroll） -->
  <div class="main-content smooth-scroll"
       aria-label='{
         "operate_type":"click",
         "action_name":"slide_direction_vertical",
         "contentDescription":"slide_direction_vertical",
         "view_id":"com.myapp:id/slide_direction_vertical"
       }'>
    
    <div class="content">
      <div class="card">
        <h2>卡片1</h2>
        <p>这是内容区域，可以正常滚动</p>
      </div>
      
      <div class="card">
        <h2>卡片2</h2>
        <p>头部始终保持固定</p>
      </div>
      
      <div class="card">
        <h2>卡片3</h2>
        <p>语音滚动有平滑动画</p>
      </div>
      
      <!-- 更多卡片... -->
    </div>
    
  </div>
  
  <script src="smooth-scroll.js"></script>
</body>
</html>
```

> 💡 **关键点说明：**
> 1. **div容器必须设置高度：** 使用 `height: 100vh` 或 `height: calc(100vh - 56px)`
> 2. **必须添加 overflow-y: auto：** 让容器可以滚动
> 3. **固定元素放在容器外：** 头部/底部等固定元素放在body下，而不是滚动容器内
> 4. **smooth-scroll类加在div上：** 而不是body上

---

## 验证测试

### 1. 控制台日志

打开Chrome远程调试，查看控制台：

```
✅ [SmoothScroll] 找到 2 个滚动容器
✅ [SmoothScroll] 已启用: body
✅ [SmoothScroll] 已启用: banner smooth-scroll
```

**如果看不到日志：**
- 检查JS文件路径是否正确
- 检查是否添加了 `smooth-scroll` class

### 2. 语音测试

说"向下滚动"或"向右滑动"，观察：

```
📊 [SmoothScroll] body 滚动事件: { scrollTop: 500, distanceY: 500, ... }
🎯 [SmoothScroll] 检测到语音滚动: body
🎬 [SmoothScroll] 开始动画
✨ [SmoothScroll] 动画完成: body
```

**如果没有动画：**
- 检查 `contentDescription` 是否匹配 `view_id` 后缀
- 查看控制台是否有错误日志

### 3. 手指滑动

用手指滑动页面，应该保持原生流畅，不触发动画。

---

## 常见问题

### Q1: 控制台显示"没有找到 .smooth-scroll 容器"

**原因：** 没有添加 `smooth-scroll` class

**解决：**
```html
<!-- ❌ 错误 -->
<body style="overflow-y: auto;">

<!-- ✅ 正确 -->
<body class="smooth-scroll" style="overflow-y: auto;">
```

### Q2: 语音说"向右滑动"但没有动画

**原因1：** contentDescription不匹配

**解决：**
```html
<!-- ❌ 错误 -->
<div aria-label='{"contentDescription":"轮播图","view_id":"...slide_direction_horizontal"}'>

<!-- ✅ 正确 -->
<div aria-label='{"contentDescription":"slide_direction_horizontal","view_id":"...slide_direction_horizontal"}'>
```

**原因2：** 容器没有设置 `overflow`

**解决：**
```html
<div class="smooth-scroll" style="overflow-x: auto;">
```

### Q3: 手指滑动也触发了动画

**原因：** `timeThreshold` 参数太小

**解决：**
```javascript
window.SmoothScrollConfig.timeThreshold = 200; // 增大到200ms
```

### Q4: 动画太快或太慢

**解决：**
```javascript
window.SmoothScrollConfig.duration = 500; // 调整动画时长（300ms → 500ms）
```

### Q5: 使用div容器方案，但页面无法滚动 ⭐

**原因：** div容器没有设置高度

**解决：**
```html
<!-- ❌ 错误：没有设置高度，div高度为0 -->
<div class="smooth-scroll" style="overflow-y: auto;">
  内容...
</div>

<!-- ✅ 正确：设置固定高度 -->
<div class="smooth-scroll" style="overflow-y: auto; height: 100vh;">
  内容...
</div>

<!-- ✅ 正确：使用calc减去固定元素高度 -->
<div class="smooth-scroll" style="overflow-y: auto; height: calc(100vh - 56px);">
  内容...
</div>
```

### Q6: 我的项目已经用了div包裹，需要改成body吗？

**答案：不需要！** div包裹方案完全符合规范，而且在很多场景下是更好的选择。

**你可以保持现有结构，只需确保：**
```html
<!-- ✅ 这样完全没问题 -->
<body>
  <div class="smooth-scroll" 
       style="overflow-y: auto; height: 100vh;"
       aria-label='{...}'>
    <!-- 你的内容 -->
  </div>
</body>
```

**何时推荐div方案：**
- ✅ 运行在WebView中
- ✅ 有固定头部或底部
- ✅ 需要复杂布局控制
- ✅ 需要避免body滚动冲突

**何时推荐body方案：**
- ✅ 简单的内容展示页
- ✅ 不需要固定元素
- ✅ 追求最简洁的代码

### Q7: div方案需要注意什么特殊配置吗？

**答案：只需注意两点即可：**

**1. 必须设置高度**
```css
.smooth-scroll {
  height: 100vh; /* 或其他固定高度 */
}
```

**2. 必须设置overflow**
```css
.smooth-scroll {
  overflow-y: auto; /* 或 overflow-x: auto */
}
```

**其他配置与body方案完全相同！**

### Q8: 我既有body滚动又有div滚动，怎么办？

**答案：都加上smooth-scroll即可！**

```html
<!-- 整页竖向滚动 -->
<body class="smooth-scroll"
      aria-label='{"contentDescription":"slide_direction_vertical",...}'>
  
  <!-- 局部横向滚动 -->
  <div class="smooth-scroll"
       aria-label='{"contentDescription":"slide_direction_horizontal",...}'>
    横向内容...
  </div>
  
</body>
```

smooth-scroll.js会自动识别和处理所有带有该class的容器。

---

## 接入检查清单

使用前请确认：

- [ ] 已复制 `smooth-scroll.js` 到项目中
- [ ] 需要滚动的容器已添加 `class="smooth-scroll"`
- [ ] 容器设置了 `overflow-x: auto` 或 `overflow-y: auto`
- [ ] `contentDescription` 等于 `view_id` 的后缀部分
- [ ] 在 `</body>` 前引入了 `<script src="smooth-scroll.js"></script>`
- [ ] 打开控制台查看是否有 "✅ 已启用" 日志
- [ ] 测试语音滚动是否有平滑动画
- [ ] 测试手指滑动是否保持流畅

---

## 技术支持

### 查看详细日志

所有滚动事件都会打印日志，包括：
- 当前滚动位置
- 滚动距离
- 时间间隔
- 是否触发动画

### 调试技巧

1. **确认JS加载：** 在控制台输入 `window.SmoothScrollConfig`，应该返回配置对象
2. **查看容器：** 在控制台输入 `document.querySelectorAll('.smooth-scroll')`，查看找到的容器
3. **模拟滚动：** 手动设置 `window.scrollTo(0, 500)` 看是否触发日志

---

## 最佳实践建议

### ✅ 推荐做法

1. **统一view_id命名**
   ```
   竖向：com.yourapp:id/slide_direction_vertical
   横向：com.yourapp:id/slide_direction_horizontal
   ```

2. **保持contentDescription简洁**
   ```
   使用：slide_direction_horizontal
   避免：首页轮播图横向滚动
   ```

3. **按需添加smooth-scroll**
   ```html
   <!-- 需要平滑滚动 -->
   <div class="smooth-scroll" style="overflow-x: auto;">
   
   <!-- 不需要平滑滚动 -->
   <div class="normal-list">
   ```

### ❌ 避免做法

1. ❌ contentDescription和view_id不匹配
2. ❌ 忘记设置overflow属性
3. ❌ 在容器内部而不是</body>前引入JS
4. ❌ 修改smooth-scroll.js的核心逻辑（除非必要）

---

## 版本记录

### v1.0 (2025-12-30)
- ✅ 支持横向和竖向滚动
- ✅ 智能区分语音和手滑
- ✅ body元素特殊处理
- ✅ 详细日志输出
- ✅ 零依赖纯JS实现

---

**接入愉快！有问题随时反馈。** 🎉
